<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  
  
  <title>  Cybrics_Matreshka_Reverse |   0x14&#39;s blog </title>

 
  
    <link rel="icon" href="/images/favicon.png">
  


  <link rel="stylesheet" href="/nayo.min.css"> 
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>  
  <body>   
    
      <header class="header">
	
  <nav class="header-inner">        

    <span class="iconfont icon-menu mobile-toggle"></span>   	

    <div class="header-logo">
      <a href="/">
        <img class="header-logo-img" src="/images/logo.png">
      </a>
    </div>

    <div class="header-menu">          
              
          
            <a class="header-menu-link" id="header-menu-home" href="/">
              <i class="iconfont icon-home">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-archives" href="/archives">
              <i class="iconfont icon-archives">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-tags" href="/tags">
              <i class="iconfont icon-tags">  
            </i></a>     
          
              
          
            <a class="header-menu-link" id="header-menu-about" href="/about">
              <i class="iconfont icon-about">  
            </i></a>     
          
              
          
              <a class="header-menu-link" id="header-menu-search">
                <i class="iconfont icon-search">  
              </i></a>
          
                  
    </div>  
    
  </nav>
</header>

   

      <div class="container">       
          
          
            <div class="container-inner">  
          

          <article class="post">
  
	
<div class="post-header">
	<div class="post-header-inner">
		<p class="post-title">	
			Cybrics_Matreshka_Reverse
		</p>
		<div class="post-info">	
			<span class="post-info-entry">
				7Êúà 22, 2019
			</span>

			
			
				<i class="iconfont icon-words"></i>
				<span class="post-info-entry">5038
				</span>
			
		</div>
	</div>
</div> 
	
 

	  <div class="typo post-content slideDownMin">

		

			
					<p>I try to play the Cybrics CTF yesterdayüòÄ‚Ä¶And the truth tell me that how suck i am‚Ä¶ Btw‚Ä¶The challenges of Cybrics is very interesting and fresh.</p>
<a id="more"></a>
<h1 id="Cybrics-Matreshka-Reverse"><a href="#Cybrics-Matreshka-Reverse" class="headerlink" title="Cybrics_Matreshka_Reverse"></a>Cybrics_Matreshka_Reverse</h1><blockquote>
<p>CyBRICS is a computer security competition (CTF) organized in a cross-university effort by BRICS countries academia.</p>
<p>The event is organized by CyBRICS coordinating universities: <a href="https://en.itmo.ru/en/" target="_blank" rel="noopener">ITMO University</a> (RU), <a href="http://en.scu.edu.cn/" target="_blank" rel="noopener">SiChuan University</a> (CN), <a href="https://www.nitw.ac.in/" target="_blank" rel="noopener">NIT Warangal</a> (IN), <a href="http://www.iitkgp.ac.in/" target="_blank" rel="noopener">IIT Kharagpur</a> (IN), <a href="https://www.wits.ac.za/" target="_blank" rel="noopener">Wits University</a> (ZA), <a href="https://www.tut.ac.za/" target="_blank" rel="noopener">Tshwane University of Technology</a> (ZA).</p>
<p>The competition is made and run by <a href="https://vk.com/spbctf" target="_blank" rel="noopener">SPbCTF</a> meetups crew (members of CTF teams LC‚ÜØBC, SiBears, PeterPEN, Yozik).</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722151354.png" alt=""></p>
<h2 id="Challenge-Matreshka"><a href="#Challenge-Matreshka" class="headerlink" title="Challenge_Matreshka"></a>Challenge_Matreshka</h2><p>Although it is easy for most individuals, i think it‚Äôs valuable.</p>
<p>appendix: <code>Code2.class</code> and <code>data2.bin</code></p>
<h2 id="Step1-Java-analysis"><a href="#Step1-Java-analysis" class="headerlink" title="Step1: Java analysis"></a>Step1: Java analysis</h2><p>You can get the source code from Code2.class by the <code>jd-gui</code> or other tools like it.</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileInputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileOutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>PrintStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>Cipher<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>SecretKey<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>SecretKeyFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>DESKeySpec<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Code2</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramArrayOfByte<span class="token punctuation">,</span> String paramString<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> Exception
  <span class="token punctuation">{</span>
    SecretKeyFactory localSecretKeyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte1 <span class="token operator">=</span> paramString<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DESKeySpec localDESKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESKeySpec</span><span class="token punctuation">(</span>arrayOfByte1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    SecretKey localSecretKey <span class="token operator">=</span> localSecretKeyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>localDESKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Cipher localCipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localCipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> localSecretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte2 <span class="token operator">=</span> localCipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>paramArrayOfByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> arrayOfByte2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramArrayOfByte<span class="token punctuation">,</span> String paramString<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
    SecretKeyFactory localSecretKeyFactory <span class="token operator">=</span> SecretKeyFactory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte1 <span class="token operator">=</span> paramString<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DESKeySpec localDESKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESKeySpec</span><span class="token punctuation">(</span>arrayOfByte1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    SecretKey localSecretKey <span class="token operator">=</span> localSecretKeyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>localDESKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Cipher localCipher <span class="token operator">=</span> Cipher<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localCipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> localSecretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte2 <span class="token operator">=</span> localCipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>paramArrayOfByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> arrayOfByte2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> paramArrayOfString<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
    String str <span class="token operator">=</span> <span class="token string">"matreha!"</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte1 <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arrayOfByte2<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arrayOfByte2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> arrayOfByte1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"No"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    File localFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"data.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FileInputStream localFileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>localFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>localFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    localFileInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arrayOfByte3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte4 <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>arrayOfByte3<span class="token punctuation">,</span> System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FileOutputStream localFileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"stage2.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>arrayOfByte4<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arrayOfByte4<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then you can know the <code>data.bin</code> is actually encoded‚Ä¶ So how to decode it and get the <code>stage2.bin</code>?</p>
<p>Obviously, the value of ‚Äúuser.name‚Äù is the key‚Ä¶Make sure it is the property of challenge environmentÔºånot our computer‚Äôs ‚Äúuser.name‚Äù‚Ä¶</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//...Ellipsis</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> paramArrayOfString<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
    String str <span class="token operator">=</span> <span class="token string">"matreha!"</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte1 <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    String username <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token function">decode</span><span class="token punctuation">(</span>arrayOfByte2<span class="token punctuation">,</span><span class="token string">"matreha!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    File localFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"data.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FileInputStream localFileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>localFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>localFile<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    localFileInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>arrayOfByte3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfByte4 <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>arrayOfByte3<span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FileOutputStream localFileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"stage2.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>arrayOfByte4<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arrayOfByte4<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localFileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//...</span>
</code></pre>
<p>Then compile the program and run it‚Ä¶</p>
<h2 id="Step2-Golang-analysis"><a href="#Step2-Golang-analysis" class="headerlink" title="Step2: Golang analysis"></a>Step2: Golang analysis</h2><p>You have got the <code>stage2.bin</code> from step1.</p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722154552.png" alt=""></p>
<p>According to the combination of static analysis and dynamic analysis, we can know the program logic as followsÔºö</p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722205942.png" alt=""></p>
<p>It should be noted that when XOR reaches the last byte, the loop produces some differences, and it is easy to ignore the key of the last byte, but this byte can be inferred‚Ä¶‚Ä¶</p>
<p><img src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722210542.png" alt=""></p>
<p>Dynamically debuggingÔºö</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722211126.png" class="lazyload"></p>
<p>The R8 stores the key byte that we should get‚Ä¶RSI stores our directory string‚Ä¶There is seventeen key bytes totally‚Ä¶After getting all the key bytes, just xor it with the Built-in ciphertext‚Ä¶</p>
<p><code>Built-in ciphertext(hex)</code>:0x53ddc587e46399144fa4142dc42404c0b0</p>
<p><code>Key(hex)</code>:0x38afaaf48c08f84b22c5605fa1576cabd1</p>
<pre class=" language-python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">58</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">from</span> libnum <span class="token keyword">import</span> n2s
In <span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">:</span> n2s<span class="token punctuation">(</span><span class="token number">0x53ddc587e46399144fa4142dc42404c0b0</span><span class="token operator">^</span><span class="token number">0x38afaaf48c08f84b22c5605fa1576cabd1</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">'kroshka_matreshka'</span>
</code></pre>
<p>Then i mv the program in a directory named ‚Äòkroshka_matreshka‚Äô and run it‚Ä¶A result.pyc‚Ä¶wellüòé</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722211935.png" class="lazyload"></p>
<p>ApparentlyÔºåwe arrived hereÔºö</p>
<p><img src="/images/placeholder.png" alt="" data-src="https://raw.githubusercontent.com/Yof3ng/images/master/img/20190722211827.png" class="lazyload"></p>
<h2 id="Step3ÔºöPython-analysis"><a href="#Step3ÔºöPython-analysis" class="headerlink" title="Step3ÔºöPython analysis"></a>Step3ÔºöPython analysis</h2><p>Decompiling <code>result.pyc</code>, then you can see the logic from source code‚Ä¶This is an eight-byte key cycle XOR encryption algorithm.</p>
<p>You have known the flag is begin with <code>cybrics{</code>Ôºåso you can directly get the keyÔºö<code>Kr0H4137</code>Ôºåthen you just get flag by decrypting the ciphertext‚Ä¶üÜó</p>
<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> result <span class="token keyword">import</span> <span class="token operator">*</span>
Enter key to get flag<span class="token punctuation">:</span>
Kr0H4137
cybrics<span class="token punctuation">{</span>M4TR35HK4_15_B35T<span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span>
</code></pre>
<h2 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h2><p>It‚Äôs a nice and full day!üòÑ</p>
  	
					
	  </div>     
	  

	<div class="post-footer">


  <div class="post-footer-other">
    
      <span class="post-footer-item">
        


<span class="donate-btn">
	<span class="iconfont icon-donate"></span>
</span>

<div id="donate-box" class="sildeUpMin">

	<span class="donate-cancel iconfont icon-cancel"></span>

	<div class="donate-img-box">
		<img id="donate-qr-wechat" class="noLazyLoad donate-img lazyload" src="/images/placeholder.png" alt="No Donate Image!" data-src="/images/donate1.png">	
		<img id="donate-qr-alipay" class="noLazyLoad donate-img lazyload" src="/images/placeholder.png" alt="No Donate Image!" data-src="/images/donate2.png">	
	</div>

	<span class="donate-word">‰∏çË¥üËá™Â∑±Ôºå‰∏çË¥üÈùíÂ§©</span>

	<div class="donate-list">
		<span class="iconfont icon-donate-wechat"></span>
		<span class="iconfont icon-donate-alipay"></span>
	</div>

</div>
 
      </span>        
       
    
      <span class="post-footer-item">
        <span class="share-btn">
	<span class="iconfont icon-share"></span>
</span>
<div class="-mob-share sildeUpMin">
	<ul class="-mob-inner">
	   			             
        <li class="iconfont 
		icon-share-qq 
		-mob-share-qq 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weixin 
		-mob-share-weixin 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-weibo 
		-mob-share-weibo 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-douban 
		-mob-share-douban 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-facebook 
		-mob-share-facebook 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-twitter 
		-mob-share-twitter 
		-mob-share-link"></li>		
   	   			             
        <li class="iconfont 
		icon-share-google 
		-mob-share-google 
		-mob-share-link"></li>		
   	   
	</ul>
</div>	


<script id="-mob-share" src="https://f1.webshare.mob.com/code/mob-share.js?appkey=21d601593a1de"></script>
      </span>  
               
  </div>  
    


  <div class="post-footer-meta">
        
          <i class="iconfont icon-category"></i>       
          <a class="category-link" href="/categories/Reverse/">Reverse</a> 	
      
        	

        
          <i class="iconfont icon-tag"></i>     
            <a class="tag-link" href="/tags/Binary/">Binary</a> <a class="tag-link" href="/tags/CTF/">CTF</a> <a class="tag-link" href="/tags/Reverse/">Reverse</a>    
        	
  </div>

</div>


<nav class="post-footer-nav">
  <div class="post-footer-link">
  
      <a href="/2019/07/21/Awesome-Cutter-radare2/" id="post-nav-older" class="post-nav-link-wrap">
        <strong class="post-nav-caption">older</strong>
        
          <span class="post-nav-title">
            Awesome_Cutter_radare2
          </span>
      </a>
  
  </div>
  <div class="post-footer-link">
    
  </div>

</nav>
 
	
	
</article>

	<div class="toc-container">
			<div class="toc-sidebar">
			<p class="toc-title">
				CONTENT
			</p>
			<div class="toc-list">
				<ol class="toc-inner"><li class="toc-inner-item toc-inner-level-1"><a class="toc-inner-link" href="#Cybrics-Matreshka-Reverse"><span class="toc-inner-text">Cybrics_Matreshka_Reverse</span></a><ol class="toc-inner-child"><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#Challenge-Matreshka"><span class="toc-inner-text">Challenge_Matreshka</span></a></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#Step1-Java-analysis"><span class="toc-inner-text">Step1: Java analysis</span></a></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#Step2-Golang-analysis"><span class="toc-inner-text">Step2: Golang analysis</span></a></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#Step3ÔºöPython-analysis"><span class="toc-inner-text">Step3ÔºöPython analysis</span></a></li><li class="toc-inner-item toc-inner-level-2"><a class="toc-inner-link" href="#Final"><span class="toc-inner-text">Final</span></a></li></ol></li></ol>
			</div>
		</div>
	</div>

          </div> 
      </div>            
    
    <a id="page-backTop">
      <span>
        <i class="iconfont icon-backtotop"></i>
      </span>
    </a> 

  
    
    <div class="search-container sildeUpMin">
        <div class="search-header">
            <input type="text" placeholder="ËæìÂÖ•‰Ω†ÊÉ≥ÊêúÁ¥¢ÁöÑ" id="search-input" class="search-input">
            <span class="search-cancel">
                <i class="iconfont icon-cancel">
            </i></span>
        </div>
        <div id="search-result" class="search-result"></div>
    </div>
 
     <div class="mobile-menu">      

      
      <img class="mobile-menu-icon lazyload" src="/images/placeholder.png" data-src="/images/favicon.png">  
      

         
            

            <a class="mobile-menu-link" href="/">È¶ñÈ°µ
            </a>
            
         
            

            <a class="mobile-menu-link" href="/archives">ÂΩíÊ°£
            </a>
            
         
            

            <a class="mobile-menu-link" href="/tags">Ê†áÁ≠æ
            </a>
            
         
            

            <a class="mobile-menu-link" href="/about">ÂÖ≥‰∫é
            </a>
            
         
                          

            <a class="mobile-menu-link mobile-menu-search" href="#">ÊêúÁ¥¢ </a>                 
            
         
      
</div>
        
    



     
    




<footer id="footer">	    

		
		<div class="footer-copyright">
		&copy;
				
		2018-
		
		2019		
	
		0x14
		<br>

		Theme  <a href="https://github.com/Lemonreds/hexo-theme-Nayo" target="_blank">Nayo</a>
		</div>			
	 
</footer>   

    <script src="/nayo.bundle.js"></script>           
  <script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":80,"height":170},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>        
</html>